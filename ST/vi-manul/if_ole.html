<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>VIM: if_ole</title>
<link rel="stylesheet" href="vim-stylesheet.css" type="text/css">
</head>
<body>
<h2>IF_OLE</h2>
<pre>
<b class="vimtag">*<a name="if_ole.txt">if_ole.txt</a>*</b>    For Vim version 6.4.  最后更新: 2005年3月16日


                  VIM 参 考 手 册    作者: Paul Moore
                                     <code class="vim">译者</code>: Dasn
                                     VCD主页: http://vimcdoc.sf.net


Vim 的 OLE 接口                                         <b class="vimtag">*<a name="ole-interface">ole-interface</a>*</b>

1. 激活 OLE 功能                |<a href="if_ole.html#ole-activation">ole-activation</a>|
2. 方法                         |<a href="if_ole.html#ole-methods">ole-methods</a>|
3. normal 命令                  |<a href="if_ole.html#ole-normal">ole-normal</a>|
4. 注册                         |<a href="if_ole.html#ole-registration">ole-registration</a>|
5. 与微软的 Visual Studio 集成  |<a href="if_ole.html#MSVisualStudio">MSVisualStudio</a>|

<code class="special">{Vi 没有这些功能}</code>

OLE 只有在编译时加入 |<a href="various.html#+ole">+ole</a>| 才可以使用。参见 src/if_ole.INSTALL。
有一点不同之处在于它使用 客户机服务器 模式进行通信 |<a href="remote.html#clientserver">clientserver</a>|。

</pre><hr class="doubleline" /><pre>
<h4>1. 激活 OLE 功能                                        <b class="vimtag">*<a name="ole-activation">ole-activation</a>*</b></h4>
Vim 可以作为 OLE 服务器运行，能被任意的 OLE 客户端访问，例如：我们可以用
Visual Basic，Python，或者 Perl 与 Vim 通信。Vim 的程序名（在 OLE 中称为
"ProgID"）是 "Vim.Application"。

因此，要启动一个 Vim 实例（或者要与一个已经启动的实例通信），你应该使用类似于
下面的代码：

[Visual Basic]
<code class="example">        Dim Vim As Object</code>
<code class="example">        Set Vim = CreateObject("Vim.Application")</code>
<code class="example"></code>
[Python]
<code class="example">        from win32com.client.dynamic import Dispatch</code>
<code class="example">        vim = Dispatch('Vim.Application')</code>
<code class="example"></code>
[Perl]
<code class="example">        use Win32::OLE;</code>
<code class="example">        $vim = new Win32::OLE 'Vim.Application';</code>
<code class="example"></code>
Vim 不能作为"隐藏"的 OLE 服务器来运行，这一点 Vim 不像其它一些 OLE 服务器。
Vim 的 OLE 客户端启动时，一个 Vim 程序的实例会立刻显现出来。简单地断开 OLE 连
接不能关掉 Vim 实例需要显式地执行退出命令才可以（例如，:qa! ， :wqa）。

</pre><hr class="doubleline" /><pre>
<h4>2. 方法                                                 <b class="vimtag">*<a name="ole-methods">ole-methods</a>*</b></h4>
Vim 为客户端提供了四种方法。

                                                        <b class="vimtag">*<a name="ole-sendkeys">ole-sendkeys</a>*</b>
SendKeys(keys)          执行一系列 keys 。

这个函数只需要一个参数，参数 keys 代表要敲击的字符串。通过此函数发送这些字符串
和你直接在 Vim 里敲击键盘的效果是一样的。特殊键可以用它们的 <code class="special">&lt;..&gt;</code> 名字，就像映
射里面最右边的一列。（执行 :map 参考特殊键的表达方式<code class="vim">译者</code>）。 <code class="note">备注</code>: 不支持
Ex 模式下的 "normal" 命令  见下面|<a href="if_ole.html#ole-normal">ole-normal</a>|。

例子：（Visual Basic 语法）
<code class="example">        Vim.SendKeys "ihello<code class="special">&lt;Esc&gt;</code>"</code>
<code class="example">        Vim.SendKeys "ma1GV4jy`a"</code>
<code class="example"></code>
这个例子假设 Vim 处于 Normal 模式，要强制进入 Normal 模式，可以在字符串前加入
<code class="keystroke">CTRL-\</code> <code class="keystroke">CTRL-N</code> ，就像这样：
<code class="example"></code>
<code class="example">        Vim.SendKeys "<code class="special">&lt;C-\&gt;</code><code class="special">&lt;C-N&gt;</code>ihello<code class="special">&lt;Esc&gt;</code>"</code>
<code class="example"></code>
（<code class="vim">译者注</code>：下面是 Perl 语法：
<code class="example"></code>
<code class="example">        $vim-&gt;SendKeys("<code class="special">&lt;C-\\&gt;</code><code class="special">&lt;C-N&gt;</code>ihello<code class="special">&lt;Esc&gt;</code>");</code>

        <code class="note">备注</code>: 在 Perl 语法里，特殊字符前需要加 "\"。）

<code class="keystroke">CTRL-\</code> <code class="keystroke">CTRL-N</code> 使得 Vim 从"插入"模式或"命令行"模式返回 Normal 模式。 <code class="note">备注</code>:
这两个字符不能用于 Vim 命令中。
                                                        <b class="vimtag">*<a name="ole-eval">ole-eval</a>*</b>
Eval(expr)              计算表达式的值。

函数只有一个参数 expr，其格式可以参考 |<a href="eval.html#expression">expression</a>|。返回值是一个包含表达式结果
的字符串。

例子：（Visual Basic 语法）
<code class="example"></code>
<code class="example">        Line20 = Vim.Eval("getline(20)")</code>
<code class="example">        Twelve = Vim.Eval("6 + 6")              ' <code class="note">注意</code>，这是一个字符串。</code>
<code class="example">        Font = Vim.Eval("&amp;guifont")</code>

                                                        <b class="vimtag">*<a name="ole-setforeground">ole-setforeground</a>*</b>
SetForeground()         让 Vim 窗口转入前台工作。

这个函数没有参数，没有返回值。


例子：（Visual Basic 语法）
<code class="example"></code>
<code class="example">        Vim.SetForeground</code>

                                                        <b class="vimtag">*<a name="ole-gethwnd">ole-gethwnd</a>*</b>
GetHwnd()       返回 Vim 窗口的句柄。

这个函数没有参数，它返回 Vim 主窗口的句柄。你可以用它来控制 Vim 窗口，或者跟踪
窗口的位置等等。

例子：（Visual Basic 语法）
<code class="example"></code>
<code class="example">        Vim_Hwnd = Vim.GetHwnd</code>


</pre><hr class="doubleline" /><pre>
<h4>3. "normal" 命令                                        <b class="vimtag">*<a name="ole-normal">ole-normal</a>*</b></h4>
因为 Vim 是通过 ex 模式下的 :normal 命令来实现对 OLE 命令的处理，所以 Vim 不能
通过 OLE 执行 :normal 命令。如果你这样做，肯定没用。至于产生的结果，可许没什么
害处，也许不能预料。

现在没有办法能捕获这种错误，所以用户在使用的时候要<code class="note">注意</code>有这么一个限制。
</pre><hr class="doubleline" /><pre>
<h4>4. 注册                                         <b class="vimtag">*<a name="ole-registration">ole-registration</a>*</b> <b class="vimtag">*<a name="E243">E243</a>*</b></h4>
在 Vim 作为 OLE 服务器运行之前，必须向系统注册。如果你想注册，可以在运行 Vim
的时候加一个参数 "-register"。
                                                        <b class="vimtag">*<a name="-register">-register</a>*</b>
<code class="example">        gvim -register</code>
<code class="example"></code>
如果运行 OLE 版本的 gvim 时，Vim 的 OLE 服务没有注册，gvim 会弹出一个对话框，
让你选择是否注册，选择 "Yes" 注册。

有时候可能注册不会成功，这可能是因为注册表不可写。如果是这个原因，你需要以
管理员的身份来运行 gvim 。

一旦注册，Vim 的路径就会被存储到注册表里。在你移动、删除或升级 Vim 之前，应该
使用 "-unregister" 清除这些注册信息。
                                                        <b class="vimtag">*<a name="-unregister">-unregister</a>*</b>
<code class="example">        gvim -unregister</code>
<code class="example"></code>
系统会使用最先注册的 Vim 执行 OLE 命令。如果 Vim 已经运行，那么就使用当前运行
的 Vim 。如果你不想让（多个） Vim 响应 OLE 命令，请使用 non-OLE 版本的 Vim ，
并且把它放到别的目录里。OLE 版本的 Vim 路径不应包含在你的正常路径里，这样当你
键入 "gvim" 时启动的才是 non-OLE 版本。

                                                        <b class="vimtag">*<a name="-silent">-silent</a>*</b>
如果不想让 Vim 在注册时弹出对话框，可以加 "-silent" 参数：

<code class="example">        gvim -silent -register</code>
<code class="example">        gvim -silent -unregister</code>
<code class="example"></code>
</pre><hr class="doubleline" /><pre>
<h4>5. 与微软的 Visual Studio 集成                  <b class="vimtag">*<a name="MSVisualStudio">MSVisualStudio</a>*</b> <b class="vimtag">*<a name="VisVim">VisVim</a>*</b></h4>
Vim 的 OLE 版本可以用做 Visual Studio 的文本编辑器。这被称作 "VisVim"。OLE 版
本的软件包里有一个 runtime 目录，详细的说明请参阅该目录下的 README_VisVim.txt
文件。

</pre><hr class="doubleline" /><pre>
<h4> vim:tw=78:ts=8:ft=help:norl:</h4>
</pre>
<p><i>Generated by vim2html on 2006年 06月 24日 星期六 00:27:59 UTC</i></p>
</body>
</html>
